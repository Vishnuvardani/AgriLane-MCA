<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - AgriLane</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
:root {
  --primary: #577656;
  --secondary: #76A37E;
  --accent: #2E4C3A;
  --light: #E6F0E6;
  --white: #ffffff;
  --dark: #1a1a1a;
  --shadow: rgba(87, 118, 86, 0.1);
  --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
  --glass: rgba(255, 255, 255, 0.1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--light);
  color: var(--dark);
  line-height: 1.6;
}

.glass {
  background: var(--glass);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s ease;
  text-decoration: none;
  display: inline-block;
}

.btn-primary {
  background: var(--gradient);
  color: var(--white);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px var(--shadow);
}

.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--accent);
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--light);
  border-radius: 8px;
  font-size: 16px;
  transition: border-color 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: var(--primary);
}

.hidden {
  display: none !important;
}

.login-body {
  background: linear-gradient(135deg, rgba(87, 118, 86, 0.7), rgba(118, 163, 126, 0.7)), url('assets/images/login-bg.jpg');
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  background-repeat: no-repeat;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.login-container {
  width: 100%;
  max-width: 400px;
}

.login-card {
  padding: 40px;
  text-align: center;
  animation: slideUp 0.6s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.login-header {
  margin-bottom: 32px;
}

.login-header .logo {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  margin-bottom: 16px;
}

.login-header .logo img {
  height: 50px;
  width: auto;
  border-radius: 6px;
}

.login-header .logo h1 {
  font-size: 32px;
  color: var(--white);
  margin: 0;
}

.login-header p {
  color: rgba(255, 255, 255, 0.8);
  font-size: 14px;
}

.login-form {
  text-align: left;
}

.login-form .form-label {
  color: var(--white);
  font-weight: 500;
}

.login-form .form-input {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: var(--white);
}

.login-form select.form-input {
  background: rgba(255, 255, 255, 0.9);
  color: var(--dark);
}

.login-form .form-input:focus {
  background: rgba(255, 255, 255, 0.15);
  border-color: var(--white);
}

.login-btn {
  width: 100%;
  background: #0C4A23;
  color: var(--white);
  font-weight: 600;
  margin-top: 8px;
}

.login-btn:hover {
  background: #0A3D1E;
  transform: translateY(-2px);
}

.login-links {
  margin-top: 24px;
  text-align: center;
}

.login-links a {
  color: rgba(255, 255, 255, 0.8);
  text-decoration: none;
  font-size: 14px;
}

.login-links a:hover {
  color: var(--white);
}

.error-message {
  background: rgba(255, 0, 0, 0.1);
  border: 1px solid rgba(255, 0, 0, 0.3);
  color: #ff6b6b;
  padding: 12px;
  border-radius: 8px;
  margin-top: 16px;
  font-size: 14px;
}

.success-message {
  background: rgba(0, 255, 0, 0.1);
  border: 1px solid rgba(0, 255, 0, 0.3);
  color: #4caf50;
  padding: 12px;
  border-radius: 8px;
  margin-top: 16px;
  font-size: 14px;
}
    </style>
</head>
<body class="login-body">
    <div class="login-container">
        <div class="login-card glass">
            <div class="login-header">
                <div class="logo">
                    <img src="assets/images/logo.jpg" alt="AgriLane Logo" class="logo-img">
                    <h1>AgriLane</h1>
                </div>
                <p>Smart Transportation & Marketplace</p>
            </div>
            
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="email" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="password" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select id="role" class="form-input" required>
                        <option value="">Select Role</option>
                        <option value="admin">Admin</option>
                        <option value="farmer">Farmer</option>
                        <option value="transporter">Transporter</option>
                        <option value="customer">Customer</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary login-btn">Login</button>
                
                <div class="login-links">
                    <a href="#" id="forgotPassword">Forgot Password?</a>
                    <span style="color: rgba(255,255,255,0.5); margin: 0 8px;">|</span>
                    <a href="#" id="signupLink">Sign Up</a>
                </div>
            </form>
            
            <!-- Signup Form -->
            <form id="signupForm" class="login-form hidden">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="signupName" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="signupEmail" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="signupPassword" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select id="signupRole" class="form-input" required>
                        <option value="">Select Role</option>
                        <option value="farmer">Farmer</option>
                        <option value="transporter">Transporter</option>
                        <option value="customer">Customer</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary login-btn">Sign Up</button>
                
                <div class="login-links">
                    <a href="#" id="loginLink">Already have an account? Login</a>
                </div>
            </form>
            
            <!-- Forgot Password Form -->
            <form id="forgotPasswordForm" class="login-form hidden">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="resetEmail" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">New Password</label>
                    <input type="password" id="newPassword" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" id="confirmPassword" class="form-input" required>
                </div>
                
                <button type="submit" class="btn btn-primary login-btn">Reset Password</button>
                
                <div class="login-links">
                    <a href="#" id="backToLogin">Back to Login</a>
                </div>
            </form>
            
            <div id="errorMessage" class="error-message hidden"></div>
            <div id="successMessage" class="success-message hidden"></div>
        </div>
    </div>
    
    <script>
// AgriLane Authentication & Role Management
function isAuthenticated() {
    return sessionStorage.getItem('user') !== null;
}

function getCurrentUser() {
    const user = sessionStorage.getItem('user');
    return user ? JSON.parse(user) : null;
}

function isAdmin() {
    const user = getCurrentUser();
    return user && user.role === 'admin';
}

function requireAuth() {
    if (!isAuthenticated()) {
        window.location.href = 'login.html';
        return false;
    }
    return true;
}

function requireAdmin() {
    if (!requireAuth()) return false;
    
    if (!isAdmin()) {
        alert('Access denied. Admin privileges required.');
        window.location.href = 'dashboard.html';
        return false;
    }
    return true;
}

function generateNavigation() {
    const user = getCurrentUser();
    if (!user) return '';
    
    const baseNav = [
        { href: 'dashboard.html', icon: 'ðŸ“Š', text: 'Dashboard' },
        { href: 'farms.html', icon: 'ðŸŒ¾', text: 'Farms' },
        { href: 'transporters.html', icon: 'ðŸš›', text: 'Transporters' },
        { href: 'marketplace.html', icon: 'ðŸ›’', text: 'Marketplace' },
        { href: 'routes.html', icon: 'ðŸ—ºï¸', text: 'Routes' },
        { href: 'deliveries.html', icon: 'ðŸ“¦', text: 'Deliveries' }
    ];
    
    if (user.role === 'admin') {
        baseNav.push({ href: 'reports.html', icon: 'ðŸ“ˆ', text: 'Reports' });
    }
    
    baseNav.push(
        { href: 'settings.html', icon: 'âš™ï¸', text: 'Settings' },
        { href: '#', icon: 'ðŸšª', text: 'Logout', onclick: 'logout()' }
    );
    
    return baseNav.map(item => 
        `<li><a href="${item.href}"${item.onclick ? ` onclick="${item.onclick}"` : ''}>${item.icon} ${item.text}</a></li>`
    ).join('');
}

function logout() {
    sessionStorage.removeItem('user');
    window.location.href = 'login.html';
}

// AgriLane Internationalization (i18n) System
const translations = {
    en: {
        title: "Login - AgriLane",
        appName: "AgriLane",
        tagline: "Smart Transportation & Marketplace",
        email: "Email",
        password: "Password",
        role: "Role",
        selectRole: "Select Role",
        admin: "Admin",
        farmer: "Farmer",
        transporter: "Transporter",
        customer: "Customer",
        login: "Login",
        forgotPassword: "Forgot Password?",
        signUp: "Sign Up"
    },
    hi: {
        title: "à¤²à¥‰à¤—à¤¿à¤¨ - à¤à¤—à¥à¤°à¥€à¤²à¥‡à¤¨",
        appName: "à¤à¤—à¥à¤°à¥€à¤²à¥‡à¤¨",
        tagline: "à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤ªà¤°à¤¿à¤µà¤¹à¤¨ à¤”à¤° à¤¬à¤¾à¤œà¤¼à¤¾à¤°",
        email: "à¤ˆà¤®à¥‡à¤²",
        password: "à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡",
        role: "à¤­à¥‚à¤®à¤¿à¤•à¤¾",
        selectRole: "à¤­à¥‚à¤®à¤¿à¤•à¤¾ à¤šà¥à¤¨à¥‡à¤‚",
        admin: "à¤ªà¥à¤°à¤¶à¤¾à¤¸à¤•",
        farmer: "à¤•à¤¿à¤¸à¤¾à¤¨",
        transporter: "à¤ªà¤°à¤¿à¤µà¤¹à¤¨à¤•à¤°à¥à¤¤à¤¾",
        customer: "à¤—à¥à¤°à¤¾à¤¹à¤•",
        login: "à¤²à¥‰à¤—à¤¿à¤¨"
    }
};

class I18n {
    constructor() {
        this.currentLang = localStorage.getItem('agrilane_language') || 'en';
        this.init();
    }
    
    init() {
        document.documentElement.lang = this.currentLang;
    }
    
    t(key) {
        return translations[this.currentLang][key] || translations.en[key] || key;
    }
    
    setLanguage(lang) {
        if (translations[lang]) {
            this.currentLang = lang;
            localStorage.setItem('agrilane_language', lang);
            document.documentElement.lang = lang;
            this.updatePageContent();
        }
    }
    
    updatePageContent() {
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            element.textContent = this.t(key);
        });
        
        document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
            const key = element.getAttribute('data-i18n-placeholder');
            element.placeholder = this.t(key);
        });
        
        if (document.querySelector('[data-i18n-title]')) {
            const key = document.querySelector('[data-i18n-title]').getAttribute('data-i18n-title');
            document.title = this.t(key);
        }
    }
}

const i18n = new I18n();
window.i18n = i18n;

// Authentication and role-based redirection
document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const forgotPasswordForm = document.getElementById('forgotPasswordForm');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    
    // Check if signup parameter is in URL
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('signup') === 'true') {
        showSignupForm();
    }
    


    // Login form handler
    loginForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const role = document.getElementById('role').value;
        
        try {
            const response = await fetch('http://localhost:5000/api/users/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password, role })
            });
            
            const data = await response.json();
            
            if (response.ok) {
                sessionStorage.setItem('user', JSON.stringify({
                    ...data.user,
                    loginTime: new Date().toISOString()
                }));
                
                switch(role) {
                    case 'admin':
                        window.location.href = 'dashboard.html';
                        break;
                    case 'farmer':
                        window.location.href = 'farms.html';
                        break;
                    case 'transporter':
                        window.location.href = 'transporters.html';
                        break;
                    case 'customer':
                        window.location.href = 'marketplace.html';
                        break;
                    default:
                        window.location.href = 'dashboard.html';
                }
            } else {
                showError(data.error || 'Login failed');
            }
        } catch (error) {
            showError('Connection error. Please try again.');
        }
    });

    // Signup form handler
    signupForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const name = document.getElementById('signupName').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        const role = document.getElementById('signupRole').value;
        
        try {
            const response = await fetch('http://localhost:5000/api/users/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, email, password, role })
            });
            
            const data = await response.json();
            
            if (response.ok) {
                showSuccess('Registration successful! Please login.');
                showLoginForm();
            } else {
                showError(data.error || 'Registration failed');
            }
        } catch (error) {
            showError('Connection error. Please try again.');
        }
    });
    
    // Forgot password form handler
    forgotPasswordForm.addEventListener('submit', function(e) {
        e.preventDefault();
        showSuccess('Password reset functionality will be implemented.');
    });
    
    // Form switching functions
    function showLoginForm() {
        loginForm.classList.remove('hidden');
        signupForm.classList.add('hidden');
        forgotPasswordForm.classList.add('hidden');
    }
    
    function showSignupForm() {
        loginForm.classList.add('hidden');
        signupForm.classList.remove('hidden');
        forgotPasswordForm.classList.add('hidden');
    }
    
    function showForgotPasswordForm() {
        loginForm.classList.add('hidden');
        signupForm.classList.add('hidden');
        forgotPasswordForm.classList.remove('hidden');
    }
    
    // Event listeners for form switching
    document.getElementById('signupLink').addEventListener('click', function(e) {
        e.preventDefault();
        showSignupForm();
    });
    
    document.getElementById('loginLink').addEventListener('click', function(e) {
        e.preventDefault();
        showLoginForm();
    });
    
    document.getElementById('forgotPassword').addEventListener('click', function(e) {
        e.preventDefault();
        showForgotPasswordForm();
    });
    
    document.getElementById('backToLogin').addEventListener('click', function(e) {
        e.preventDefault();
        showLoginForm();
    });
    
    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.classList.remove('hidden');
        successMessage.classList.add('hidden');
        setTimeout(() => {
            errorMessage.classList.add('hidden');
        }, 5000);
    }
    
    function showSuccess(message) {
        successMessage.textContent = message;
        successMessage.classList.remove('hidden');
        errorMessage.classList.add('hidden');
        setTimeout(() => {
            successMessage.classList.add('hidden');
        }, 5000);
    }
});
    </script>
</body>
</html>